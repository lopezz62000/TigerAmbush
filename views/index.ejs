<!DOCTYPE html>
<html>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <body>
        <h1>Welcome to TigerAmbush</h1>
        <p id="roomID" style="display: none;"><%= roomID %></p>
        <p id="fullName" style="display: none;"><%= fullName %></p>
        <p id="appLink" style="display: none;"><%= appLink %></p>
        <textarea id="chatbox" rows="4" cols="50"></textarea>
        <br />
        <br />
        <input id="messagebox" placeholder="Type your message..."/>
        <button type="button" onclick="send()">Send</button>
        <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
        <script type="text/javascript">
            var roomID = document.getElementById("roomID").innerHTML;
            var fullName = document.getElementById("fullName").innerHTML;
            var appLink = document.getElementById("appLink").innerHTML;
            var socket = io.connect(appLink);

            socket.on('connect', function(data) {
                socket.emit('join', {"message":  fullName + " has entered the room.", "roomID": roomID});
            });

            socket.on('disperse'+roomID, function(data) {
                var messages = document.getElementById("chatbox").value + data + "\n";
                var chatbox = document.getElementById('chatbox'); 
                chatbox.value = messages;
                chatbox.scrollTop = chatbox.scrollHeight; 
            });

            function send() {
                socket.emit('send', {"message": fullName + ": " + document.getElementById("messagebox").value, "roomID": roomID});
                document.getElementById("messagebox").value = "";
            }

            window.addEventListener("beforeunload", function (e) {
                socket.emit('leave', roomID);
            });
        </script>
    </body>
</html>